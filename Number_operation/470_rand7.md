# 470 rand7实现rand10

给定方法 rand7 可生成 [1,7] 范围内的均匀随机整数，试写一个方法 rand10 生成 [1,10] 范围内的均匀随机整数。

你只能调用 rand7() 且不能调用其他方法。请不要使用系统的 Math.random() 方法。

## case

输入的数字表示调用rand10的次数，rand10这个函数本身没有输入值

```python
n = [1,2,3]
```

## 思路

总体的思路需要应用一个词语：拒绝采样，即无限循环采样，如果不满足条件就抛弃(拒绝)并循环，如果满足条件则终止循环，所以这个题的解法模板，一定是有一个while True

```
while True:
    res = xxx
    if res 条件满足:
        return res
    
```



### 思路1

给定了rand7，可以随机生成[1,7]的数字，那么想要生成[1,10]的随机数字，第一个很容易想到的就是两次rand7相乘，即rand7()*rand7(),得到的应该是[1,49]的数字，那么直接取前十个即可(错误)，这个相乘的思路没问题，但是有一个误区就是没有考虑**概率相等**，[1,49]这些数字出现的概率是不相等的，比如2这个结果，可能是1\*2得到的，也可能是2\*1得到的，概率分布如下：

![image-20220210101709066](/Users/duying5/Library/Application Support/typora-user-images/image-20220210101709066.png)

所以这个思路，需要选取的是概率相等的10个数字，在答题时，需要把这两个表画出来，然后无脑判断两次rand7相乘之后的结果是否在[2,3,5,7,8,10,14,15,16,20]中即可(这些数字的概率都是2/49)

### 思路2

这道题的解法看起来有很多种，所有的解法只要满足两个条件: 1.得到的数字范围要大于[1,10]；2.概率相等

在满足基本条件以外，其实还可以选择一个尽可能减少使用rand7次数的解法(其实是降低了期望的时间复杂度)

这里有一个如何通过rand7生成rand49的写法(注意不能是简单的rand7*rand7，因为概率不相等)：

```python
(rand7()-1)*7 + rand7()
```

要想真正理解为什么它会生成均匀的[1,49]，需要理解两种算法：

* 首先`rand7()*7`会均匀的生成`[1,7,14,21,28,35,42,49]`这几个数字(其实是以7的倍数)，那么`(rand7()-1)*7`会生成`[0,7,14,,21,28,35,42]`这几个数字，这个算法就是：rand7()和某一个数字相乘，会得到这个数字的倍数的一个等概率序列

* 其次rand7()+rand7()会生成什么呢？答案是生成不了[2,14]的等概率，因为3可能有两种组合(1+2,2+1)，但是14只有一个(7+7)

  但是(rand7()-1)*7 + rand7()却可以生成[1,49],分解一下这个算式:

  * 首先 rand7()-1 得到的数的集合为 { 0,1,2,3,4,5,6}
  * (Rand7()-1)*7得到集合A{0,7,14,21,28,35}
  * rand7() 得到集合B{1,2,3,4,5,6,7}

  集合A+集合B得到{1,..49},这一步骤用概率轮解释是因为A和B是独立事件，用笨方法就是列表格，如下是rand7+rand7和集合A+集合B的排列，可以一目了然的看出第二种是均匀的

  | 相加 | 1    | 2    | 3    | 4    | 5    | 6    | 7    |
  | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
  | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    |
  | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    |
  | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   |
  | 4    | 5    | 6    | 7    | 8    | 9    | 10   | 11   |
  | 5    | 6    | 7    | 8    | 9    | 10   | 11   | 12   |
  | 6    | 7    | 8    | 9    | 10   | 11   | 12   | 13   |
  | 7    | 8    | 9    | 10   | 11   | 12   | 13   | 14   |

  (rand7-1)*7+rand7

| 相加 | 0    | 7    | 14   | 21   | 28   | 35   | 42   |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 1    | 1    | 8    | 15   | 22   | 29   | 36   | 43   |
| 2    | 2    | 9    | 16   | 23   | 30   | 37   | 44   |
| 3    | 3    | 10   | 17   | 24   | 31   | 38   | 45   |
| 4    | 4    | 11   | 18   | 25   | 32   | 39   | 46   |
| 5    | 5    | 12   | 19   | 26   | 33   | 40   | 47   |
| 6    | 6    | 13   | 20   | 27   | 34   | 41   | 48   |
| 7    | 7    | 14   | 21   | 28   | 35   | 42   | 49   |

好了，理解了关键的{1..49}的生成方法，就可以容易的写出后续的答案，后续的思路，无非是降低"拒绝"的概率了

```python
def rand10():
    while True:
        ## a: 1--49
        a = (rand7()-1)*7+rand7()
        if a <= 40:
            return a%10 + 1

        a -= 40
        ## a: 1--63
        a = (a-1)*7+rand7()
        if a <= 60:
            return a%10 + 1
```



## 总结